{% extends 'base.html' %} 
{% load static %} 
{% block title %}
Dashboard - Scout
Monitoring
{% endblock %} 
{% block page_title %}Dashboard{% endblock %} 
{% block content %}
<!-- Stats Grid -->
<div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4 mb-8">
  <!-- Internet Speed Card -->
  <div class="stat-card">
    <div class="flex items-center justify-between">
      <div>
        <p class="metric-label">Débit Internet</p>
        <p class="metric-value">
          {{ internet_speed }} <span class="text-lg text-gray-600">Mbps</span>
        </p>
      </div>
      <div class="bg-primary-100 rounded-full p-3">
        <svg
          class="h-8 w-8 text-primary-600"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M13 10V3L4 14h7v7l9-11h-7z"
          />
        </svg>
      </div>
    </div>
    <div class="mt-4">
      <div class="flex items-center text-sm">
        <span class="text-success-600 font-medium">+12%</span>
        <span class="text-gray-600 ml-2">vs dernière heure</span>
      </div>
    </div>
  </div>

  <!-- Server CPU Card -->
  <div class="stat-card">
    <div class="flex items-center justify-between">
      <div>
        <p class="metric-label">CPU Serveur</p>
        <p class="metric-value">
          {{ server_cpu }}<span class="text-lg text-gray-600">%</span>
        </p>
      </div>
      <div class="bg-warning-100 rounded-full p-3">
        <svg
          class="h-8 w-8 text-warning-600"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"
          />
        </svg>
      </div>
    </div>
    <div class="mt-4">
      <div class="w-full bg-gray-200 rounded-full h-2">
        <div
          class="bg-warning-500 h-2 rounded-full"
          style="width: {{ server_cpu }}%"
        ></div>
      </div>
    </div>
  </div>

  <!-- RAM Card -->
  <div class="stat-card">
    <div class="flex items-center justify-between">
      <div>
        <p class="metric-label">RAM Serveur</p>
        <p class="metric-value">
          {{ server_ram }}<span class="text-lg text-gray-600">%</span>
        </p>
      </div>
      <div class="bg-success-100 rounded-full p-3">
        <svg
          class="h-8 w-8 text-success-600"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"
          />
        </svg>
      </div>
    </div>
    <div class="mt-4">
      <div class="w-full bg-gray-200 rounded-full h-2">
        <div
          class="bg-success-500 h-2 rounded-full"
          style="width: {{ server_ram }}%"
        ></div>
      </div>
    </div>
  </div>

  <!-- Active Alerts Card -->
  <div class="stat-card">
    <div class="flex items-center justify-between">
      <div>
        <p class="metric-label">Alertes Actives</p>
        <p class="metric-value">{{ active_alerts }}</p>
      </div>
      <div class="bg-danger-100 rounded-full p-3">
        <svg
          class="h-8 w-8 text-danger-600"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
          />
        </svg>
      </div>
    </div>
    <div class="mt-4">
      <a
        href="{% url 'alerts' %}"
        class="text-sm font-medium text-primary-600 hover:text-primary-700"
      >
        Voir toutes les alertes →
      </a>
    </div>
  </div>
</div>

<!-- Main Content Grid -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
  <!-- Network Traffic Chart -->
  <div class="card">
    <h3 class="card-header">Trafic Réseau (24h)</h3>
    <canvas id="networkChart" height="300"></canvas>
  </div>

  <!-- Top Consumers -->
  <div class="card">
    <h3 class="card-header">Top Consommateurs</h3>
    <div class="space-y-4">
      {% for consumer in top_consumers %}
      <div
        class="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors"
      >
        <div class="flex items-center space-x-3">
          <div class="bg-primary-100 rounded-full p-2">
            <svg
              class="h-5 w-5 text-primary-600"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
              />
            </svg>
          </div>
          <div>
            <p class="font-medium text-gray-900">{{ consumer.username }}</p>
            <p class="text-sm text-gray-500">{{ consumer.ip_address }}</p>
          </div>
        </div>
        <div class="text-right">
          <p class="font-bold text-gray-900">{{ consumer.bandwidth }} MB</p>
          <p class="text-sm text-gray-500">{{ consumer.percentage }}%</p>
        </div>
      </div>
      {% empty %}
      <p class="text-gray-500 text-center py-8">Aucune donnée disponible</p>
      {% endfor %}
    </div>
  </div>
</div>

<!-- Recent Alerts -->
<div class="card">
  <div class="flex items-center justify-between mb-6">
    <h3 class="card-header mb-0">Alertes Récentes</h3>
    <a
      href="{% url 'alerts' %}"
      class="text-sm font-medium text-primary-600 hover:text-primary-700"
    >
      Voir tout →
    </a>
  </div>

  <div class="overflow-hidden">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Statut
          </th>
          <th
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Message
          </th>
          <th
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Type
          </th>
          <th
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Date
          </th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        {% for alert in recent_alerts %}
        <tr class="hover:bg-gray-50">
          <td class="px-6 py-4 whitespace-nowrap">
            {% if alert.severity == 'critical' %}
            <span class="badge badge-danger">Critique</span>
            {% elif alert.severity == 'warning' %}
            <span class="badge badge-warning">Avertissement</span>
            {% else %}
            <span class="badge badge-info">Info</span>
            {% endif %}
          </td>
          <td class="px-6 py-4">
            <p class="text-sm font-medium text-gray-900">{{ alert.message }}</p>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
            {{ alert.metric_type }}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
            {{ alert.created_at|date:"d/m/Y H:i" }}
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="4" class="px-6 py-8 text-center text-gray-500">
            Aucune alerte récente
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %} {% block extra_scripts %}
<script>
  // Network Traffic Chart
  const ctx = document.getElementById('networkChart').getContext('2d');
  const networkChart = new Chart(ctx, {
      type: 'line',
      data: {
          labels: {{ chart_labels|safe }},
          datasets: [{
              label: 'Trafic Entrant (Mbps)',
              data: {{ chart_data_in|safe }},
              borderColor: 'rgb(75, 139, 50)',
              backgroundColor: 'rgba(75, 139, 50, 0.1)',
              tension: 0.4,
              fill: true
          }, {
              label: 'Trafic Sortant (Mbps)',
              data: {{ chart_data_out|safe }},
              borderColor: 'rgb(249, 248, 113)',
              backgroundColor: 'rgba(249, 248, 113, 0.1)',
              tension: 0.4,
              fill: true
          }]
      },
      options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
              legend: {
                  display: true,
                  position: 'top',
              }
          },
          scales: {
              y: {
                  beginAtZero: true,
                  ticks: {
                      callback: function(value) {
                          return value + ' Mbps';
                      }
                  }
              }
          }
      }
  });
</script>
{% endblock %}
