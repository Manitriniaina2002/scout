{% extends 'base.html' %} {% load static %} {% block title %}Métriques - Scout
Monitoring{% endblock %} {% block page_title %}Métriques et Performances{%
endblock %} {% block content %}
<!-- Time Range Selector -->
<div class="bg-white rounded-lg shadow-md p-4 mb-6">
  <div class="flex items-center justify-between">
    <div class="flex gap-2">
      <button
        class="px-4 py-2 text-sm font-medium bg-primary-600 text-white rounded-lg"
      >
        1H
      </button>
      <button
        class="px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg"
      >
        6H
      </button>
      <button
        class="px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg"
      >
        24H
      </button>
      <button
        class="px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg"
      >
        7J
      </button>
      <button
        class="px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg"
      >
        30J
      </button>
    </div>
    <button class="btn-primary">
      <svg
        class="inline-block w-4 h-4 mr-2"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"
        />
      </svg>
      Exporter CSV
    </button>
  </div>
</div>

<!-- Metrics Charts Grid -->
<div class="grid grid-cols-1 xl:grid-cols-2 gap-6 mb-6">
  <!-- Network Bandwidth -->
  <div class="card">
    <h3 class="card-header">Bande Passante Réseau</h3>
    <canvas id="bandwidthChart" height="250"></canvas>
    <div class="mt-4 grid grid-cols-2 gap-4">
      <div class="text-center p-3 bg-primary-50 rounded-lg">
        <p class="text-sm text-primary-600 font-medium">Débit Moyen</p>
        <p class="text-2xl font-bold text-primary-900">
          {{ avg_bandwidth }} Mbps
        </p>
      </div>
      <div class="text-center p-3 bg-success-50 rounded-lg">
        <p class="text-sm text-success-600 font-medium">Pic Maximum</p>
        <p class="text-2xl font-bold text-success-900">
          {{ max_bandwidth }} Mbps
        </p>
      </div>
    </div>
  </div>

  <!-- Server Performance -->
  <div class="card">
    <h3 class="card-header">Performances Serveur</h3>
    <canvas id="serverChart" height="250"></canvas>
    <div class="mt-4 grid grid-cols-3 gap-2">
      <div class="text-center p-2 bg-gray-50 rounded">
        <p class="text-xs text-gray-600">CPU</p>
        <p class="text-lg font-bold text-gray-900">{{ current_cpu }}%</p>
      </div>
      <div class="text-center p-2 bg-gray-50 rounded">
        <p class="text-xs text-gray-600">RAM</p>
        <p class="text-lg font-bold text-gray-900">{{ current_ram }}%</p>
      </div>
      <div class="text-center p-2 bg-gray-50 rounded">
        <p class="text-xs text-gray-600">Disque</p>
        <p class="text-lg font-bold text-gray-900">{{ current_disk }}%</p>
      </div>
    </div>
  </div>

  <!-- Response Time -->
  <div class="card">
    <h3 class="card-header">Temps de Réponse</h3>
    <canvas id="responseChart" height="250"></canvas>
  </div>

  <!-- Connection Stats -->
  <div class="card">
    <h3 class="card-header">Connexions Actives</h3>
    <canvas id="connectionsChart" height="250"></canvas>
  </div>
</div>

<!-- Metrics Table -->
<div class="card">
  <h3 class="card-header">Historique des Métriques</h3>
  <div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Timestamp
          </th>
          <th
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Type
          </th>
          <th
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Valeur
          </th>
          <th
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Statut
          </th>
          <th
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Anomalie
          </th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        {% for metric in metrics %}
        <tr class="hover:bg-gray-50">
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
            {{ metric.timestamp|date:"d/m/Y H:i:s" }}
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span
              class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800"
            >
              {{ metric.metric_type }}
            </span>
          </td>
          <td
            class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"
          >
            {{ metric.value }} {{ metric.unit }}
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            {% if metric.status == 'normal' %}
            <span class="badge badge-success">Normal</span>
            {% elif metric.status == 'warning' %}
            <span class="badge badge-warning">Attention</span>
            {% else %}
            <span class="badge badge-danger">Critique</span>
            {% endif %}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
            {% if metric.is_anomaly %}
            <span class="text-danger-600 font-medium">⚠️ Oui</span>
            {% else %}
            <span class="text-success-600">✓ Non</span>
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="5" class="px-6 py-8 text-center text-gray-500">
            Aucune métrique disponible
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %} {% block extra_scripts %}
<script>
  // Bandwidth Chart
  new Chart(document.getElementById('bandwidthChart'), {
      type: 'line',
      data: {
          labels: {{ bandwidth_labels|safe }},
          datasets: [{
              label: 'Bande passante',
              data: {{ bandwidth_data|safe }},
              borderColor: 'rgb(14, 165, 233)',
              backgroundColor: 'rgba(14, 165, 233, 0.1)',
              tension: 0.4,
              fill: true
          }]
      },
      options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display: false } }
      }
  });

  // Server Performance Chart
  new Chart(document.getElementById('serverChart'), {
      type: 'line',
      data: {
          labels: {{ server_labels|safe }},
          datasets: [{
              label: 'CPU',
              data: {{ cpu_data|safe }},
              borderColor: 'rgb(239, 68, 68)',
              tension: 0.4
          }, {
              label: 'RAM',
              data: {{ ram_data|safe }},
              borderColor: 'rgb(34, 197, 94)',
              tension: 0.4
          }]
      },
      options: {
          responsive: true,
          maintainAspectRatio: false
      }
  });

  // Response Time Chart
  new Chart(document.getElementById('responseChart'), {
      type: 'bar',
      data: {
          labels: {{ response_labels|safe }},
          datasets: [{
              label: 'Temps de réponse (ms)',
              data: {{ response_data|safe }},
              backgroundColor: 'rgba(234, 179, 8, 0.8)'
          }]
      },
      options: {
          responsive: true,
          maintainAspectRatio: false
      }
  });

  // Connections Chart
  new Chart(document.getElementById('connectionsChart'), {
      type: 'doughnut',
      data: {
          labels: ['Actives', 'Inactives', 'En attente'],
          datasets: [{
              data: {{ connections_data|safe }},
              backgroundColor: [
                  'rgb(34, 197, 94)',
                  'rgb(156, 163, 175)',
                  'rgb(234, 179, 8)'
              ]
          }]
      },
      options: {
          responsive: true,
          maintainAspectRatio: false
      }
  });
</script>
{% endblock %}
